<!DOCTYPE html>
<html lang="fr">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>videostore Skeleton</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

  <!-- CSS & JQUERY
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/style.css">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>

<script>
function getXMLHttpRequest() {
	var xhr = null;
	
	if (window.XMLHttpRequest || window.ActiveXObject) {
		if (window.ActiveXObject) {
			try {
				xhr = new ActiveXObject("Msxml2.XMLHTTP");
			} catch(e) {
				xhr = new ActiveXObject("Microsoft.XMLHTTP");
			}
		} else {
			xhr = new XMLHttpRequest(); 
		}
	} else {
		alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest...");
		return null;
	}
	
	return xhr;
	}
	
	function connexion(callback) {
		var xhr = getXMLHttpRequest();

		var Mail = encodeURIComponent(document.getElementById("mail").value);
		var Mdp = encodeURIComponent(document.getElementById("mdp").value);
		
		xhr.onreadystatechange = function() {
		
			if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
				callback(xhr.responseText);
			}
		};
		var params = "mail="+Mail+"&password="+Mdp;
		xhr.open("POST","http://api.videostore.fr/users/connexion",true);
   		xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhr.send(params);
		return false;
	}

		function connexionGet() {
		var xhr = getXMLHttpRequest();

		var Pseudo = encodeURIComponent(document.getElementById("mail").value);
		var Mdp = encodeURIComponent(document.getElementById("mdp").value);
		
		xhr.onreadystatechange = function() {
		
			if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
				alert(xhr.responseText);
				document.getElementById("myDiv").innerHTML = "user :"+ xhr.responseText;
			}
		};
		
		xhr.open("GET","http://api.videostore.fr/users/connexion/" + Pseudo , true);
		xhr.send(null);
		return false;
	}


	function getMovies() {
		var data;
		var xhr = getXMLHttpRequest();
		
		xhr.onreadystatechange = function() {
		
			if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
				alert("getmovies");
				data = JSON.parse(xhr.responseText);
				for(i=0;i<data.length;i++)
					document.getElementById("myDiv").innerHTML=data[i].title;
				//document.getElementById("myDiv").innerHTML= xhr.responseText;
			}
		};
		xhr.open("GET","http://api.videostore.fr/videos",true);
		xhr.send();

		return false;
	}

</script>
</head>

<body>

<h2>My Movies Collection:</h2>
<div id="myDiv"></div>
<input type="text" id="mail" name="mail"></input>
<input type="password" id="mdp" name="mdp"></input>
<button type="button" onclick="connexionGet()">Connexion</button>
 
</body>
</html>
